---
title: "Gráfico Tema 3"
author: "Carolina Martínez, Álvaro Cruz, Roberto Millan y Alexandra Estela Garcia"
date: "2024-02-29"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Librerías**
Cargamos las librerías que vamos a utilizar.

```{r Librerias}
library(ggplot2)
library(tidyverse)
library(plotly)
library(dplyr)
library(showtext)
```

**Importación de datos**
Cargamos en una variable los datos de la web.
```{r Datos}
data <- read.csv("https://covid.ourworldindata.org/data/owid-covid-data.csv")
```

**Modificación de variables**
Cambiamos el formato de las variables para poder manejarlas de mejor manera.

```{r Variables}
#Ponemos el formato de fecha adecuado
data$date <- as.Date(data$date)

#Creamos un vector con los paises que queremos representar
paises <- c("Spain","Italy","United States", "Germany","Canada", "Japan","United Kingdom", "France")

#Creamos un nuevo df con las variables que necesitamos para el gráfico
paises <- data %>% group_by(location, date) %>% filter(location %in% paises) %>%
  summarise(muertes = new_deaths_smoothed_per_million)

#Uno distinto para España para poder modificar el ancho de linea
spain <- data %>% group_by(location, date) %>% filter(location == "Spain") %>%
  summarise(muertes = new_deaths_smoothed_per_million)
```


**Gráfico**
Creamos el grafico con la librería 'ggplot2'

```{r Gráfico}
#Primero creamos un vector con los colores que vamos a utilizar
colores <- c("Spain"="red","Italy" = "cyan4",
             "United States" = "darkorchid4", "Germany" = "palegreen4",
             "Canada" = "orangered4", "Japan" = "skyblue4", 
             "United Kingdom" = "maroon", "France" = "sienna")
paises$location <- as.factor(paises$location)

#Ponemos las fuentes de texto que vamos a utilizar
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Roboto", "Roboto")
font_add_google("EB Garamond", "gara")

showtext.auto()


#Creamos el gráfico
graf <- ggplot(paises, aes(x = date,y = muertes, color = location)) +
  geom_line() + geom_line(mapping = aes(x = date, y = muertes),
                          colour = "red", data = spain, linewidth = 1 ) + 
  scale_colour_manual(values = colores) + 
  labs(title = "Daily new confirmed COVID-19 deaths per million people", 
       subtitle = "7-day rolling average. For some countries the number of confirmed deaths is much lower than the true number of deaths. This is because of limited
testing and challenges in the attribution of the couse of death.", x = NULL, y = NULL, caption = "Source:Johns Hopkins University CSSE COVID-19 Data")+ 
  theme(plot.title = element_text(size = 20, 
                                  colour = "#222222",
                                  family = "gara"),
        plot.subtitle = element_text(size = 10,
                                     colour = "#757575",
                                     family = "Roboto"),
        plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))
graf
```

**Gráfico interactivo**

```{r Grafico interactivo}
grafite <- ggplotly(graf)
grafite

```




